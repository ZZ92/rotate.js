<html><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>rotatle img</title>
</head>
<body style='border:0px;padding:0;margin:0'>
		<canvas id="pic_testImg" width="1280" height="800" style='border:0px;padding:0;margin:0'></canvas>
    <img src="./test.png" id="testImg" step="0" style="display: none;">
<script>
	
 
		function getQueryStringByName(name){

		     var result = location.search.match(new RegExp("[\?\&]" + name+ "=([^\&]+)","i"));

		     if(result == null || result.length < 1){

		         return "";

		     }

		     return result[1];

		}
		
    function rotateImg(canvas,img,step) {
			
			  var ctx = canvas.getContext('2d');
				
		    if (img == null || step >3 ||step <0) console('no image');
		    //img的高度和宽度不能在img元素隐藏后获取，否则会出错
		    var height = img.height;
		    var width = img.width;
				
	      canvas.width = width;
	      canvas.height = height;
			
        var degree = step * 90 * Math.PI / 180;
        
        switch (step) {
            case 0:
                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0);
                break;
            case 1:
                canvas.width = height;
                canvas.height = width;
                ctx.rotate(degree);
                ctx.drawImage(img, 0, -height);
                break;
            case 2:
                canvas.width = width;
                canvas.height = height;
                ctx.rotate(degree);
                ctx.drawImage(img, -width, -height);
                break;
            case 3:
                canvas.width = height;
                canvas.height = width;
                ctx.rotate(degree);
                ctx.drawImage(img, -width, 0);
                break;
        }
    }
		
		window.onload = function(){
			var canvas = document.getElementById('pic_testImg');
	    var img = document.getElementById('testImg');
			// var src = getQueryStringByName('src');
			
			// img.setAttribte('src',src)
			rotateImg(canvas,img,1);	
		};
</script>
	
</body></html>